{
    "$schema": "https://vega.github.io/schema/vega-lite/v5.json",
    "title": "Covid-19 cases",
    "projection": {
        "type": "equirectangular"
    },

    "params": [{
        "name": "Year_selection",
        "value": 2018,
        "bind": {
            "input": "range",
            "min": 2010,
            "max": 2020,
            "step": 1,
            "name": "Year:  "
        }
    }],
    "data": {
        "url": "owid-covid-data_2.csv"
    },
    "transform": [
        { "filter": "datum.continent != ''" }
    ],
    "hconcat": [{
        "layer": [{
                "width": 400,
                "height": 400,
                "data": {
                    "url": "https://raw.githubusercontent.com/KaneSec/vega_lite/main/2_symbol_map/js/ne_110m_admin_0_countries.topojson",
                    "format": {
                        "type": "topojson",
                        "feature": "ne_110m_admin_0_countries"
                    }

                },
                "transform": [{
                    "calculate": "'Data is not available in ' + datum.properties.NAME",
                    "as": "note"
                }],
                "mark": {
                    "type": "geoshape",
                    "fill": "#ddd",
                    "stroke": "white",
                    "strokeWidth": 1
                },
                "encoding": { "tooltip": { "field": "note" } }
            },
            {
                "transform": [
                    { "filter": { "param": "time_brush" } },
                    {
                        "aggregate": [{
                            "op": "sum",
                            "field": "new_cases",
                            "as": "sum_new_cases"
                        }],
                        "groupby": ["Country", "iso_code", "continent"]
                    },
                    {
                        "lookup": "iso_code",
                        "from": {
                            "data": {
                                "url": "https://raw.githubusercontent.com/KaneSec/vega_lite/main/2_symbol_map/js/ne_110m_admin_0_countries.topojson",
                                "format": {
                                    "type": "topojson",
                                    "feature": "ne_110m_admin_0_countries"
                                }
                            },
                            "key": "properties.ADM0_A3_IS"
                        },
                        "as": "geo"
                    }
                ],
                "mark": { "type": "geoshape", "stroke": "#fff", "strokeWidth": 0.5 },
                "encoding": {
                    "shape": { "field": "geo", "type": "geojson" },
                    "color": {
                        "field": "sum_new_cases",
                        "type": "quantitative",
                        "scale": {
                            "type": "log"
                        }
                    },
                    "tooltip": [
                        { "field": "location", "type": "nominal", "title": "Country" },
                        {
                            "field": "new_cases",
                            "type": "quantitative",
                            "title": "New Cases",
                            "format": ","
                        },
                        { "field": "date", "type": "temporal", "title": "Date" }
                    ]
                }
            }
        ]
    }, {
        "width": 400,
        "height": 400,
        "params": [{
            "name": "time_brush",
            "select": { "type": "interval", "encodings": ["x"] }
        }],
        "mark": { "type": "area", "cornerRadiusTopLeft": 3, "cornerRadiusTopRight": 3 },
        "encoding": {
            "x": { "timeUnit": "yearmonth", "field": "date", "type": "ordinal" },
            "y": { "aggregate": "sum", "field": "new_cases" },
            "color": { "field": "continent" }
        }
    }],

    "config": {}
}